
 <% @saisonId = params[:saisonId] %>
 <% @divisionId = Event.find(@eventId).division_id %> 
 <% @eventNum = Event.find(@eventId).numero %>
 <% @numGp = Event.find(@eventId).numero  %>

<% @labels = Event.where(saison_id: @saisonId, division_id: @divisionId).numero_until_courant(@numGp).pluck(:numero)  %> 

<%# @listePilotes = Pilote.division_courant(@divisionId).statut_actif.pluck(:id, :nom) %> 


<% @listePilotesNew = Resultat.division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).group(:pilote_id).pluck(:pilote_id) %> 

 <% nbPilotes = @listePilotesNew.count %> 

<% @piloteId1 = @listePilotesNew[0] %>
<% @piloteNom1 = Pilote.find(@piloteId1).nom %> 
<% @piloteEcurie1 = Pilote.find(@piloteId1).ecurie %>
<% @couleurEcurie1 = Equipe.find(@piloteEcurie1).couleurRgb %> 

<% if nbPilotes > 1 %>
    <% @listePilotesNew[1] %> 
    <% @piloteId2 = @listePilotesNew[1] %>
    <% @piloteNom2 = Pilote.find(@piloteId2).nom %> 
    <% @piloteEcurie2 = Pilote.find(@piloteId2).ecurie %> 
    <% @couleurEcurie2 = Equipe.find(@piloteEcurie2).couleurRgb %> 
<% end %>

<% if nbPilotes > 2 %>
    <% @listePilotesNew[2] %> 
    <% @piloteId3 = @listePilotesNew[2] %>
    <% @piloteNom3 = Pilote.find(@piloteId3).nom %> 
    <% @piloteEcurie3 = Pilote.find(@piloteId3).ecurie %> 
    <% @couleurEcurie3 = Equipe.find(@piloteEcurie3).couleurRgb %> 
<% end %>

<% if nbPilotes > 3 %>
    <% @listePilotesNew[3] %> 
    <% @piloteId4 = @listePilotesNew[3] %>
    <% @piloteNom4 = Pilote.find(@piloteId4).nom %> 
    <% @piloteEcurie4 = Pilote.find(@piloteId4).ecurie %> 
    <% @couleurEcurie4 = Equipe.find(@piloteEcurie4).couleurRgb %> 
<% end %>

<% if nbPilotes > 4 %>
    <% @listePilotesNew[4] %> 
    <% @piloteId5 = @listePilotesNew[4] %>
    <% @piloteNom5 = Pilote.find(@piloteId5).nom %> 
    <% @piloteEcurie5 = Pilote.find(@piloteId5).ecurie %> 
    <% @couleurEcurie5 = Equipe.find(@piloteEcurie5).couleurRgb %> 
<% end %>

<% if nbPilotes > 5 %>
    <% @listePilotesNew[5] %> 
    <% @piloteId6 = @listePilotesNew[5] %>
    <% @piloteNom6 = Pilote.find(@piloteId6).nom %> 
    <% @piloteEcurie6 = Pilote.find(@piloteId6).ecurie %> 
    <% @couleurEcurie6 = Equipe.find(@piloteEcurie6).couleurRgb %> 
<% end %>

<% if nbPilotes > 6 %>
    <% @listePilotesNew[6] %> 
    <% @piloteId7 = @listePilotesNew[6] %>
    <% @piloteNom7 = Pilote.find(@piloteId7).nom %> 
    <% @piloteEcurie7 = Pilote.find(@piloteId7).ecurie %> 
    <% @couleurEcurie7 = Equipe.find(@piloteEcurie7).couleurRgb %> 
<% end %>

<% if nbPilotes > 7 %>
    <% @listePilotesNew[7] %> 
    <% @piloteId8 = @listePilotesNew[7] %>
    <% @piloteNom8 = Pilote.find(@piloteId8).nom %> 
    <% @piloteEcurie8 = Pilote.find(@piloteId8).ecurie %> 
    <% @couleurEcurie8 = Equipe.find(@piloteEcurie8).couleurRgb %> 
<% end %>

<% if nbPilotes > 8 %>
    <% @listePilotesNew[8] %> 
    <% @piloteId9 = @listePilotesNew[8] %>
    <% @piloteNom9 = Pilote.find(@piloteId9).nom %> 
    <% @piloteEcurie9 = Pilote.find(@piloteId9).ecurie %> 
    <% @couleurEcurie9 = Equipe.find(@piloteEcurie9).couleurRgb %> 
<% end %>

<% if nbPilotes > 9 %>
    <% @listePilotesNew[9] %> 
    <% @piloteId10 = @listePilotesNew[9] %>
    <% @piloteNom10 = Pilote.find(@piloteId10).nom %> 
    <% @piloteEcurie10 = Pilote.find(@piloteId10).ecurie %> 
    <% @couleurEcurie10 = Equipe.find(@piloteEcurie10).couleurRgb %> 
<% end %>

<% if nbPilotes > 10 %>
    <% @listePilotesNew[10] %> 
    <% @piloteId11 = @listePilotesNew[10] %>
    <% @piloteNom11 = Pilote.find(@piloteId11).nom %> 
    <% @piloteEcurie11 = Pilote.find(@piloteId11).ecurie %> 
    <% @couleurEcurie11 = Equipe.find(@piloteEcurie11).couleurRgb %> 
<% end %>

<% if nbPilotes > 11 %>
    <% @listePilotesNew[11] %> 
    <% @piloteId12 = @listePilotesNew[11]%>
    <% @piloteNom12 = Pilote.find(@piloteId12).nom %> 
    <% @piloteEcurie12 = Pilote.find(@piloteId12).ecurie %> 
    <% @couleurEcurie12 = Equipe.find(@piloteEcurie12).couleurRgb %> 
<% end %>

<% if nbPilotes > 12 %>
    <% @listePilotesNew[12] %> 
    <% @piloteId13 = @listePilotesNew[12] %>
    <% @piloteNom13 = Pilote.find(@piloteId13).nom %> 
    <% @piloteEcurie13 = Pilote.find(@piloteId13).ecurie %> 
    <% @couleurEcurie13 = Equipe.find(@piloteEcurie13).couleurRgb %> 
<% end %>

<% if nbPilotes > 13 %>
    <% @listePilotesNew[13] %> 
    <% @piloteId14 = @listePilotesNew[13] %>
    <% @piloteNom14 = Pilote.find(@piloteId14).nom %> 
    <% @piloteEcurie14 = Pilote.find(@piloteId14).ecurie %> 
    <% @couleurEcurie14 = Equipe.find(@piloteEcurie14).couleurRgb %> 
<% end %>

<% if nbPilotes > 14 %>
    <% @listePilotesNew[14] %> 
    <% @piloteId15 = @listePilotesNew[14]%>
    <% @piloteNom15 = Pilote.find(@piloteId15).nom %> 
    <% @piloteEcurie15 = Pilote.find(@piloteId15).ecurie %> 
    <% @couleurEcurie15 = Equipe.find(@piloteEcurie15).couleurRgb %> 
<% end %>

<% if nbPilotes > 15 %>
    <% @listePilotesNew[15] %> 
    <% @piloteId16 = @listePilotesNew[15] %>
    <% @piloteNom16 = Pilote.find(@piloteId16).nom %> 
    <% @piloteEcurie16 = Pilote.find(@piloteId16).ecurie %> 
    <% @couleurEcurie16 = Equipe.find(@piloteEcurie16).couleurRgb %> 
<% end %>

<% if nbPilotes > 16 %>
    <% @listePilotesNew[16] %> 
    <% @piloteId17 = @listePilotesNew[16] %>
    <% @piloteNom17 = Pilote.find(@piloteId17).nom %> 
    <% @piloteEcurie17 = Pilote.find(@piloteId17).ecurie %> 
    <% @couleurEcurie17 = Equipe.find(@piloteEcurie17).couleurRgb %> 
<% end %>

<% if nbPilotes > 17 %>
    <% @listePilotesNew[17]%> 
    <% @piloteId18 = @listePilotesNew[17] %>
    <% @piloteNom18 = Pilote.find(@piloteId18).nom %> 
    <% @piloteEcurie18 = Pilote.find(@piloteId18).ecurie %> 
    <% @couleurEcurie18 = Equipe.find(@piloteEcurie18).couleurRgb %> 
<% end %>

<% if nbPilotes > 18 %>
    <% @listePilotesNew[18] %> 
    <% @piloteId19 = @listePilotesNew[18] %>
    <% @piloteNom19 = Pilote.find(@piloteId19).nom %> 
    <% @piloteEcurie19 = Pilote.find(@piloteId19).ecurie %> 
    <% @couleurEcurie19 = Equipe.find(@piloteEcurie19).couleurRgb %> 
<% end %>

<% if nbPilotes > 19 %>
    <% @listePilotesNew[19] %>  
    <% @piloteId20 = @listePilotesNew[19] %>
    <% @piloteNom20 = Pilote.find(@piloteId20).nom %> 
    <% @piloteEcurie20 = Pilote.find(@piloteId20).ecurie %> 
    <% @couleurEcurie20 = Equipe.find(@piloteEcurie20).couleurRgb %> 
<% end %>

<%# permet d'avoir les resultats du pilote 5 a chaque gp sans somme %>
  <% @data1 = Resultat.where(pilote_id: @piloteId1).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data2 = Resultat.where(pilote_id: @piloteId2).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data3 = Resultat.where(pilote_id: @piloteId3).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data4 = Resultat.where(pilote_id: @piloteId4).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data5 = Resultat.where(pilote_id: @piloteId5).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data6 = Resultat.where(pilote_id: @piloteId6).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data7 = Resultat.where(pilote_id: @piloteId7).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data8 = Resultat.where(pilote_id: @piloteId8).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data9 = Resultat.where(pilote_id: @piloteId9).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data10 = Resultat.where(pilote_id: @piloteId10).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %>
  <% @data11 = Resultat.where(pilote_id: @piloteId11).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data12 = Resultat.where(pilote_id: @piloteId12).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data13 = Resultat.where(pilote_id: @piloteId13).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data14 = Resultat.where(pilote_id: @piloteId14).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data15 = Resultat.where(pilote_id: @piloteId15).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data16 = Resultat.where(pilote_id: @piloteId16).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data17 = Resultat.where(pilote_id: @piloteId17).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data18 = Resultat.where(pilote_id: @piloteId18).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data19 = Resultat.where(pilote_id: @piloteId19).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 
  <% @data20 = Resultat.where(pilote_id: @piloteId20).division_courant(@divisionId).saison_courant(@saisonId).numero_until_courant(@numGp).pluck(:score).map!(&:to_i) %> 



<div class="chart-container" style="position: relative; height:80%; width:100%">
  <canvas id="myChart"></canvas> 
</div>

<script>

var labels = <%= @labels %>;

  var data1 = <%= @data1 %>;
  var data2 = <%= @data2 %>;
  var data3 = <%= @data3 %>;
  var data4 = <%= @data4 %>;
  var data5 = <%= @data5 %>;
  var data6 = <%= @data6 %>;
  var data7 = <%= @data7 %>;
  var data8 = <%= @data8 %>;
  var data9 = <%= @data9 %>;
  var data10 = <%= @data10 %>;
  var data11 = <%= @data11 %>;
  var data12 = <%= @data12 %>;
  var data13 = <%= @data13 %>;
  var data14 = <%= @data14 %>;
  var data15 = <%= @data15 %>;
  var data16 = <%= @data16 %>;
  var data17 = <%= @data17 %>;
  var data18 = <%= @data18 %>;
  var data19 = <%= @data19 %>;
  var data20 = <%= @data20 %>;

  const data = {
    labels: labels,
   
    datasets: [
          
    {
      label: "<%= @piloteNom1 %>",
      backgroundColor: "<%= @couleurEcurie1 %>",
      borderColor: "<%= @couleurEcurie1 %>",
      data: data1,
    },
    {
      label: "<%= @piloteNom2 %>",
      backgroundColor: "<%= @couleurEcurie2 %>",
      borderColor: "<%= @couleurEcurie2 %>",
      data: data2,
    },
    {
      label: "<%= @piloteNom3 %>",
      backgroundColor: "<%= @couleurEcurie3 %>",
      borderColor: "<%= @couleurEcurie3 %>",
      data: data3,
     
    },
    {
      label: "<%= @piloteNom4 %>",
      backgroundColor: "<%= @couleurEcurie4 %>",
      borderColor: "<%= @couleurEcurie4 %>",
      data: data4,
    },
    {
      label: "<%= @piloteNom5 %>",
      backgroundColor: "<%= @couleurEcurie5 %>",
      borderColor: "<%= @couleurEcurie5 %>",
      data: data5,
    },
    {
      label: "<%= @piloteNom6 %>",
      backgroundColor: "<%= @couleurEcurie6 %>",
      borderColor: "<%= @couleurEcurie6 %>",
      data: data6,
    },
    {
      label: "<%= @piloteNom7 %>",
      backgroundColor: "<%= @couleurEcurie7 %>",
      borderColor: "<%= @couleurEcurie7 %>",
      data: data7,
    },
    {
      label: "<%= @piloteNom8 %>",
      backgroundColor: "<%= @couleurEcurie8 %>",
      borderColor: "<%= @couleurEcurie8 %>",
      data: data8,
    },
    {
      label: "<%= @piloteNom9 %>",
      backgroundColor: "<%= @couleurEcurie9 %>",
      borderColor: "<%= @couleurEcurie9 %>",
      data: data9,
    },
    {
      label: "<%= @piloteNom10 %>",
      backgroundColor: "<%= @couleurEcurie10 %>",
      borderColor: "<%= @couleurEcurie10 %>",
      data: data10,
    },
    {
      label: "<%= @piloteNom11 %>",
      backgroundColor: "<%= @couleurEcurie11 %>",
      borderColor: "<%= @couleurEcurie11 %>",
      data: data11,
    },
    {
      label: "<%= @piloteNom12 %>",
      backgroundColor: "<%= @couleurEcurie12 %>",
      borderColor: "<%= @couleurEcurie12 %>",
      data: data12,
    },
    {
      label: "<%= @piloteNom13 %>",
      backgroundColor: "<%= @couleurEcurie13 %>",
      borderColor: "<%= @couleurEcurie13 %>",
      data: data13,
    },
    {
      label: "<%= @piloteNom14 %>",
      backgroundColor: "<%= @couleurEcurie14 %>",
      borderColor: "<%= @couleurEcurie14 %>",
      data: data14,
    },
    {
      label: "<%= @piloteNom15 %>",
      backgroundColor: "<%= @couleurEcurie15 %>",
      borderColor: "<%= @couleurEcurie15 %>",
      data: data15,
    },
    {
      label: "<%= @piloteNom16 %>",
      backgroundColor: "<%= @couleurEcurie16 %>",
      borderColor: "<%= @couleurEcurie16 %>",
      data: data16,
    },
    {
      label: "<%= @piloteNom17 %>",
      backgroundColor: "<%= @couleurEcurie17 %>",
      borderColor: "<%= @couleurEcurie17 %>",
      data: data17,
    },
    {
      label: "<%= @piloteNom18 %>",
      backgroundColor: "<%= @couleurEcurie18 %>",
      borderColor: "<%= @couleurEcurie18 %>",
      data: data18,
    },
    {
      label: "<%= @piloteNom19 %>",
      backgroundColor: "<%= @couleurEcurie19 %>",
      borderColor: "<%= @couleurEcurie19 %>",
      data: data19,
    },
    {
      label: "<%= @piloteNom20 %>",
      backgroundColor: "<%= @couleurEcurie20 %>",
      borderColor: "<%= @couleurEcurie20 %>",
      data: data20,
    }
    ]
  };

    let delayed;
    const config = {
        type: 'line',
        data: data,
        options: {
           
            plugins: {
            legend: {
                display: false
            },
        },

            animation: {
                onComplete: () => {
                    delayed = true;
                },
                delay: (context) => {
                    let delay = 0;
                    if (context.type === 'data' && context.mode === 'default' && !delayed) {
                    delay = context.dataIndex * 3000  + context.datasetIndex * 100;
                    }
                    return delay;
                },
            },
           
            borderColor:"#308af3",
           /* pointBackgroundColor: "#308af3",*/
            pointBorderWidth: 3,
           /* pointHoverBackgroundColor: "#fff", */
            pointHoverBorderWidth: 6,
            lineTension: 0.4,
            borderWidth: 4,
            scales: {
              y: {
                ticks: {
                  font: {
                    size: 16
                  },     
                },
              beginAtZero: true,
                title: {
                  display: true,
                  text: 'Points',
                  font: {
                    size: 18
                  },
                }
              },
              x: {
                ticks: {
                  font: {
                    size: 16
                  },  
                   /* callback: function(value, index, ticks) {
                        return 'GP ' + value ;*/
                },
                title: {
                  display: true,
                  text: 'GP',
                  font: {
                    size: 18
                  },
                }
              },
            }
          }
      };
</script>

<script>
  const myChart = new Chart(
    document.getElementById('myChart'),
    config
  );
</script>
